#!/bin/bash

source scl_source enable devtoolset-7

if [ -n "$APP_SCRIPT" ]; then
    PROJECT_PATH=./quicklisp/local-projects/${APP_SYSTEM_NAME}
    SBCL_OPTS=(
        "${SBCL_OPTS[@]}"
        --dynamic-space-size "${APP_MEM-256}"
        --load "${PROJECT_PATH}/$(eval echo ${APP_SCRIPT})"
    )
else
    SBCL_OPTS=(
        "${SBCL_OPTS[@]}"
        --dynamic-space-size "${APP_MEM-256}"
        --eval "(ql:quickload :$(eval echo ${APP_SYSTEM_NAME}))"
        --eval "$(eval echo ${APP_EVAL})"
    )
fi

sbcl "${SBCL_OPTS[@]}"
